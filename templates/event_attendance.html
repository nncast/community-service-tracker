{% extends "base.html" %}
{% block title %}Event Attendance{% endblock %}

{% block content %}
<h2>Attendance for Event: {{ event.name }} ({{ event.date.strftime('%Y-%m-%d') }})</h2>

<form method="post" action="{{ url_for('save_event_attendance', event_id=event.id) }}">
<table border="1" cellpadding="5">
    <tr>
        <th>Student ID</th>
        <th>Name</th>
        <th>Year Level</th>
        <th>Signed In</th>
        <th>Signed Out</th>
        <th>Accumulated Hours</th>
    </tr>

    {% for att in attendances %}
    <tr>
        <td>{{ att.student.student_id }}</td>
        <td>{{ att.student.fname }} {{ att.student.mname }} {{ att.student.lname }}</td>
        <td>{{ att.student.year_level.level }}-{{ att.student.year_level.section }}</td>
        <td>
            <input type="checkbox" name="timed_in_{{ att.id }}" value="1" {% if att.timed_in %}checked{% endif %}>
        </td>
        <td>
            <input type="checkbox" name="timed_out_{{ att.id }}" value="1" {% if att.timed_out %}checked{% endif %}>
        </td>
        <td>
            {% if att.timed_in and att.timed_out %}
                0
            {% elif att.timed_in or att.timed_out %}
                {{ event.required_hours / 2 }}
            {% else %}
                {{ event.required_hours }}
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
<br>
<button type="submit">Save Attendance</button>
</form>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul style="color:red;">
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% endblock %}
