{% extends "base.html" %}
{% block title %}Edit Event{% endblock %}

{% block content %}

<h2>Edit Event</h2>

<form method="post" action="{{ url_for('edit_event', event_id=event.id) }}">
    <label>Event Name:</label>
    <input type="text" name="name" value="{{ event.name }}" required>

    <label>Date:</label>
    <input type="date" name="date" value="{{ event.date }}" required>

    <label>Required Hours:</label>
    <input type="number" step="0.1" name="required_hours" value="{{ event.required_hours }}" required>

    <label>Target Year Level:</label><br>

    <label>
        <input type="checkbox" name="target_years" value="all" onclick="toggleYearSelection(this)"
            {% if event.target_years == 'all' %}checked{% endif %}>
        All
    </label><br>

    {% for i in range(1, 5) %}
        <label>
            <input type="checkbox" name="target_years" value="{{ i }}"
                {% if event.target_years != 'all' and (i|string) in event.target_years.split(',') %}checked{% endif %}>
            {{ i }}{% if i==1 %}st{% elif i==2 %}nd{% elif i==3 %}rd{% else %}th{% endif %} Year
        </label><br>
    {% endfor %}

    <button type="submit">Update Event</button>
</form>

<hr>
<a href="{{ url_for('events') }}">Back to Events List</a>

<script>
function toggleYearSelection(allCheckbox) {
    const yearCheckboxes = document.querySelectorAll('input[name="target_years"]:not([value="all"])');
    if (allCheckbox.checked) {
        yearCheckboxes.forEach(cb => cb.checked = true);
    } else {
        yearCheckboxes.forEach(cb => cb.checked = false);
    }
}

document.querySelectorAll('input[name="target_years"]:not([value="all"])').forEach(cb => {
    cb.addEventListener('change', () => {
        const allCheckbox = document.querySelector('input[name="target_years"][value="all"]');
        const allChecked = Array.from(document.querySelectorAll('input[name="target_years"]:not([value="all"])'))
                                .every(cb => cb.checked);
        allCheckbox.checked = allChecked;
    });
});
</script>

{% endblock %}
